#!/bin/sh

set -e

{{- if eq .chezmoi.os "linux" }}
#################
# LINUX GENERIC #
#################

# Tailscale
curl -fsSL https://tailscale.com/install.sh | sh

# neovim
wget -O ~/.local/bin/nvim https://github.com/neovim/neovim/releases/latest/download/nvim-linux-x86_64.appimage
chmod +x ~/.local/bin/nvim

# Change default shell to zsh
chsh -s $(which zsh)

# Rust and cargo
#curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh


{{-   if eq .chezmoi.osRelease.id "ubuntu" "debian" }}
##########
# UBUNTU #
##########

## Chezmoi
## Of course chezmoi has to be installed already, but this is where I document how
# snap install chezmoi --classic
# chezmoi init https://git.mich0.com/mich0/dotfiles.git
# chezmoi apply

sudo apt upgrade
sudo apt install fzf ripgrep bat cargo zoxide lazygit
sudo apt install git tmux alacritty zsh curl i3 gnome-session lightdm rofi

#----------- XRemap -------------
cargo install xremap --features x11

sudo groupadd uinput
sudo usermod -aG input $USER
sudo usermod -aG uinput $USER
echo 'KERNEL=="uinput", MODE="0660", GROUP="uinput", OPTIONS+="static_node=uinput"' | \
    sudo tee /etc/udev/rules.d/99-xremap.rules > /dev/null
# Reload udev rules
sudo udevadm control --reload-rules
# Trigger udev to apply the new rule
sudo udevadm trigger
# Load the uinput kernel module (it may already be loaded)
sudo modprobe uinput

systemctl --user daemon-reload
systemctl --user enable xremap.service
#--------------------------------

# required for lazyvim
curl -fsSL https://deb.nodesource.com/setup_22.x | sudo -E bash -
sudo apt install nodejs
echo "remember to run 'Copilot auth' inside lazyvim"
read

# Fonts
sudo mkdir -p /usr/local/share/fonts/nerd-fonts
wget -O /tmp/InconsolataGo.zip https://github.com/ryanoasis/nerd-fonts/releases/download/v3.4.0/Inconsolata.zip
sudo unzip /tmp/InconsolataGo.zip -d /usr/local/share/fonts/nerd-fonts/Inconsolata
sudo fc-cache -fv

# Visual Studio Code
wget -O /tmp/vscode.deb https://vscode.download.prss.microsoft.com/dbazure/download/stable/7d842fb85a0275a4a8e4d7e040d2625abbf7f084/code_1.105.1-1760482543_amd64.deb
sudo apt install /tmp/vscode.deb
rm /tmp/vscode.deb

{{-   else if eq .chezmoi.osRelease.id "almalinux" }}
#############
# ALMALINUX #
#############
sudo dnf install fzf lazygit ripgrep zoxide bat
{{-   end }}


{{- else if eq .chezmoi.os "darwin" }}
###########
# MAC OSX #
###########
brew install fzf lazygit ripgrep zoxide bat
{{- end }}
